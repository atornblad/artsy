<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Building a MOD tracker in JavaScript</title>
    <script src="tracker.js"></script>
    <style>
        pre { margin: 0; }
    </style>
</head>
<body>
    <button id="play" class="mod-player" data-modfile="./livin-insanity.mod">Livin' Insanity</button>
    <button id="play" class="mod-player" data-modfile="./part-2/elekfunk.mod">Elekfunk!</button>
    <button id="play" class="mod-player" data-modfile="./part-3/mobyle.mod">Mobyle</button>
    <script>
        const modPlayerButtons = Array.from(document.querySelectorAll('button.mod-player'));
        for (let button of modPlayerButtons) {
            const modFile = button.dataset.modfile;
            tracker(modFile).then(player => player.load().then(() => {
                for (let i = 0; i < 128; ++i) {
                    for (let j = 0; j < 64; j += 4) {
                        player.watch('songpos', i, j, (songPos, row, tick) => console.log(`Songpos: ${songPos} Bar: ${row / 4}`));
                    }
                }

                if (modFile === './livin-insanity.mod') {
                    player.watch('start', 0, 0, () => console.log('Intro started'));
                    player.watch('recttunnel', 2, 0, () => console.log('Rectangular bitmap tunnel started'));
                }

                button.addEventListener('click', async (e) => {
                    await player.play();
                })
            }));
        }
    </script>
</body>
</html>